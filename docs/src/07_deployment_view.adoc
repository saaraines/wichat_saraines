ifndef::imagesdir[:imagesdir: ../images]

[[section-deployment-view]]
== Vista de Despliegue

[role="arc42help"]
****
.Contenido
Describe el entorno técnico donde se ejecuta el sistema, incluyendo infraestructura, máquinas y configuración de red.

.Motivación
El software no funciona sin hardware. Esta vista muestra el entorno físico o virtual necesario para ejecutar la aplicación.
****

=== Infraestructura de Despliegue

==== Entorno de Desarrollo

El sistema se ejecuta localmente durante el desarrollo con la siguiente configuración:

[plantuml, "deployment-dev", png]
----
@startuml
node "Máquina de Desarrollo" {
    node "Puerto 3000" {
        [WIQ Webapp\n(React)]
    }

    node "Puerto 8000" {
        [Gateway Service]
    }

    node "Puerto 8001" {
        [Auth Service]
    }

    node "Puerto 8002" {
        [User Service]
    }

    node "Puerto 8003" {
        [Question Service]
    }

    node "Puerto 8004" {
        [LLM Service]
    }

    database "Puerto 27017" {
        [MongoDB]
    }
}

cloud "APIs Externas" {
    [Wikidata API]
    [Gemini API]
}

[WIQ Webapp\n(React)] --> [Gateway Service] : HTTP
[Gateway Service] --> [Auth Service] : HTTP
[Gateway Service] --> [User Service] : HTTP
[WIQ Webapp\n(React)] --> [Question Service] : HTTP
[WIQ Webapp\n(React)] --> [LLM Service] : HTTP

[Auth Service] --> [MongoDB] : MongoDB Protocol
[User Service] --> [MongoDB] : MongoDB Protocol
[Question Service] --> [MongoDB] : MongoDB Protocol

[Question Service] ..> [Wikidata API] : HTTPS
[LLM Service] ..> [Gemini API] : HTTPS
@enduml
----

**Descripción:**
* Todos los servicios se ejecutan localmente en la misma máquina
* Cada servicio usa un puerto diferente para evitar conflictos
* MongoDB se ejecuta como proceso local en el puerto por defecto
* Las APIs externas se acceden vía HTTPS

==== Entorno de Testing

Durante la ejecución de tests:

* *Tests Unitarios (Jest)*:
- Usan mongodb-memory-server para simular MongoDB en memoria
- No requieren servicios externos activos
- Se ejecutan de forma aislada para cada microservicio

* *Tests E2E (Puppeteer + Cucumber)*:
- Requieren todos los servicios ejecutándose localmente
- MongoDB debe estar activo con datos de prueba
- Puppeteer controla un navegador Chrome headless

==== Configuración de Red

[options="header",cols="1,1,2"]
|===
| Servicio | Puerto | URL Local
| Frontend | 3000 | http://localhost:3000
| Gateway | 8000 | http://localhost:8000
| Auth Service | 8001 | http://localhost:8001
| User Service | 8002 | http://localhost:8002
| Question Service | 8003 | http://localhost:8003
| LLM Service | 8004 | http://localhost:8004
| MongoDB | 27017 | mongodb://localhost:27017
|===

==== Variables de Entorno

Cada servicio requiere configuración mediante variables de entorno:

* *MONGODB_URI*: Cadena de conexión a MongoDB
* *JWT_SECRET*: Clave secreta para firmar tokens JWT
* *GEMINI_API_KEY*: Clave de API para acceder a Gemini
* *PORT*: Puerto donde se ejecuta cada servicio
* *CORS_ORIGIN*: Origen permitido para peticiones CORS

==== Requisitos del Sistema

**Hardware mínimo:**
* CPU: 2 cores
* RAM: 4 GB
* Disco: 2 GB disponibles

**Software necesario:**
* Node.js 18 o superior
* MongoDB 6.0 o superior
* npm o yarn para gestión de dependencias
* Navegador web moderno (Chrome, Firefox, Edge)
