ifndef::imagesdir[:imagesdir: ../images]

[[section-building-block-view]]
== Vista de Bloques de Construcción

=== Sistema Completo (Nivel 1)

El sistema WIChat está compuesto por los siguientes bloques principales:

[role="arc42help"]
****
.Contenido
Visión general del sistema completo mostrando los bloques principales y sus relaciones.

.Motivación
Proporciona una visión de alto nivel de la estructura del sistema para facilitar la comprensión de los componentes principales.
****

==== Diagrama de Nivel 1

image::diagrama_wichat.png[Diagrama de arquitectura del sistema]

==== Bloques del Sistema

[options="header",cols="1,2"]
|===
| Bloque | Descripción
| *WIQ Webapp* | Aplicación web desarrollada en React con Material-UI. Interfaz de usuario que permite jugar, ver estadísticas y obtener pistas mediante chat con IA.
| *Gateway Service* | Punto de entrada del sistema. Orquesta las peticiones entre el frontend y los servicios backend de autenticación y usuarios.
| *Auth Service* | Gestiona la autenticación de usuarios mediante validación de credenciales y generación de tokens JWT.
| *User Service* | Maneja el registro de nuevos usuarios y almacenamiento de información personal y estadísticas de juego.
| *Question Generation Service* | Obtiene datos de Wikidata, genera preguntas de trivia para las tres categorías (Capitales, Banderas, Monumentos) y las almacena en MongoDB.
| *LLM Service* | Proporciona pistas generadas por IA usando Gemini API para ayudar a los jugadores durante las partidas.
| *MongoDB* | Base de datos que almacena usuarios, preguntas generadas e historial de partidas.
| *Wikidata* | API externa de donde se obtienen los datos para generar las preguntas de trivia.
| *Gemini API* | API de Google que proporciona el modelo de IA para generar pistas contextuales.
|===

=== Nivel 2

==== Frontend (WIQ Webapp)

El frontend está estructurado en componentes React que gestionan diferentes funcionalidades:

[options="header",cols="1,2"]
|===
| Componente | Responsabilidad
| *Componentes de Autenticación* | Login y registro de usuarios
| *Componentes de Juego* | Visualización de preguntas, opciones y validación de respuestas para cada categoría
| *Sistema de Pistas* | Chat que permite solicitar hints al LLM Service durante el juego
| *Panel de Estadísticas* | Visualización de gráficos y datos del rendimiento del usuario (usando recharts)
| *Panel de Administración* | Gestión de usuarios y visualización de estadísticas globales (solo admins)
|===

==== Backend Services

===== Gateway Service

Responsabilidades:

* Recibir todas las peticiones del frontend
* Enrutar solicitudes de autenticación al Auth Service
* Enrutar solicitudes de gestión de usuarios al User Service
* Gestionar CORS y configuración de seguridad

===== Auth Service

Responsabilidades:

* Validar credenciales de usuario contra MongoDB
* Generar tokens JWT para sesiones autenticadas
* Verificar tokens en peticiones protegidas

===== User Service

Responsabilidades:

* Registrar nuevos usuarios en MongoDB
* Almacenar y actualizar historial de partidas
* Proporcionar datos para estadísticas de usuario

===== Question Generation Service

Responsabilidades:

* Consultar Wikidata para obtener datos actualizados
* Generar preguntas con opciones múltiples
* Almacenar preguntas en MongoDB
* Servir preguntas al frontend según categoría solicitada

===== LLM Service

Responsabilidades:

* Recibir contexto de la pregunta actual
* Construir prompts adecuados para Gemini API
* Gestionar la conversación y proporcionar pistas sin revelar la respuesta directamente

=== Nivel 3

Para esta aplicación, el nivel 2 proporciona suficiente detalle sobre la estructura interna de cada servicio. Cada microservicio sigue una arquitectura estándar de Express con:

* Rutas (routes): Definen los endpoints disponibles
* Controladores (controllers): Lógica de negocio de cada endpoint
* Modelos (models): Esquemas de MongoDB
* Servicios auxiliares: Funciones de utilidad y llamadas a APIs externas
